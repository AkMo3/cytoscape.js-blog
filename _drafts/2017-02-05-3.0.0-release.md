---
layout: post
title: Announcing Cytoscape.js v3
subtitle: New features, breaking changes, and migration from v2 to v3
tags:
- news
---

Cytoscape.js 3 has been released!
[As promised]({% post_url 2016-06-06-2.7-3.0-and-beyond %}), the majority of the changes are housekeeping-related, with a few significant (read: breaking) API changes to help with usability and future-proofing as JS evolves.

# Overview
- Functions with `function(i, ele)` signature are now `function(ele, i)` [#1531](https://github.com/cytoscape/cytoscape.js/issues/1531)
- `cy.layout()` and `eles.layout()` now return the layout, rather than chaining the calling object [#1533](https://github.com/cytoscape/cytoscape.js/issues/1533)
- `this` is no longer modified to be the element of interest for many callback functions [#1535](https://github.com/cytoscape/cytoscape.js/issues/1535)
- **TODO: add rest of things to overview**
- **TODO: investigate DocToc for a table of contents/ list of changes**

# API Changes and Migration

- Functions with a `function(i, ele)` signature are now `function(ele, i)` [#1531](https://github.com/cytoscape/cytoscape.js/issues/1531)
  - Affects: `eles.each()`, `eles.bfs()`, `eles.dfs()`, `eles.filter()`, `eles.positions()`, `eles.layoutPositions()`
  - It's now simpler to use ES6 syntax for operations on elements! Example:

  ```javascript
  // v2
  cy.elements().each(function(i, ele){
    console.log( ele.id() + ' is ' + ( ele.selected() ? 'selected' : 'not selected' ) );
  });
  // new v3 syntax; we can ignore the index i
  cy.elements().each(ele => console.log( ele.id() + ' is ' ( ele.selected() ? 'selected' : 'not selected' ) ) );
  ```

- `cy.layout()` and `eles.layout()` now return the layout (rather than chaining the calling object) [#1533](https://github.com/cytoscape/cytoscape.js/issues/1533)
  - Any code which previously ran a layout by calling `eles.layout( opts )` or `cy.layout( opts )` should be changed to `eles.layout( opts ).run()` or `cy.layout( opts ).run()`

- `this` is no longer modified for many callbacks [#1535](https://github.com/cytoscape/cytoscape.js/issues/1535)
  - Affects: 
    - `eles.each()`
    - `eles.filter()`
    - `eles.positions()`
    - `eles.layoutPositions()`
    - `eles.bfs()`
    - `eles.dfs()`
    - `eles.dijkstra()`
    - `eles.aStar()`
    - `eles.bellmanFord()`
    - `eles.kruskal()`
    - `eles.floydWarshall()`
    - `eles.pageRank()`
    - `eles.closenessCentrality()` and `eles.closenessCentralityNormalized()`
    - `eles.betweennessCentrality()` and `eles.betweennessCentralityNormalized()`
    - `eles.degreeCentrality()` and `eles.degreeCentralityNormalized()`
    - concentric and cose layouts (already deprecated)
  - Avoiding changing `this` in the bodies of functions (keeps the `this` context from outside the function) makes
  [working with arrow functions nicer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#No_bindingof_this)
  - **TODO: add code example for this one since it's complex**

- `cy` prefix has been removed from names of event fields [#1537](https://github.com/cytoscape/cytoscape.js/issues/1537)
  - `cy*` properties no longer have the `cy` prefix.
  For example, `event.cyTarget` is now `event.target`.

- A clearer distinction is made between `display`, `visibility`, and `opacity` in the internal API [#1544](https://github.com/cytoscape/cytoscape.js/issues/1544)
  - **Only applies to internal APIs**
  - `display`, `visibility`, and `opacity` refer to whether an element takes up space, whether an element is visible, and whether an element is interactive
  - `display`: Whether to display the element; may be `element` for displayed or `none` for not displayed
  - `visibility`: Whether the element is visible; may be `visible` or `hidden`
  - `opacity`: The opacity of an element, ranging from 0 to 1.
    The opacity of a compound node parent will also affect children.

  | Property | Takes up space | bundled bezier edges take up space | visibility of connected edges | interactive
  |:-|:-|:-|:-|:-
  | `display: none` | no | no | hidden | no
  | `visibility: hidden` | yes | yes | visible | no
  | `opacity: 0` | yes | yes | visible | yes

- The `:touch` selector has been removed [#1540](https://github.com/cytoscape/cytoscape.js/issues/1540)
  - It's less reliable now that browsers are implementing touch APIs without hardware support.
  This means that the `:touch` selector will sometimes report that touch is supported even when the user's device lacks touch capabilities.

- `cy.onRender()` and `cy.offRender()` have been replaced with the `render` event [#1541](https://github.com/cytoscape/cytoscape.js/issues/1541)
  - `cy.onRender(fn)` becomes `cy.on('render', fn)`

- The `grab` event has been broken into two parts: `grab` and `grabon` [#1545](https://github.com/cytoscape/cytoscape.js/issues/1545)
  -  `grab` now refers to *all* elements that are currently being grabbed (such as during a drag). `grabon` refers to the element that the user's mouse/ finger is over while grabbing the elements
 
- The jQuery plugin has been removed [#1539](https://github.com/cytoscape/cytoscape.js/issues/1539)
  - It's still possible to pass a jQuery element to Cytoscape.js during initialization, but Cytoscape.js will no longer register itself as a jQuery plugin

  v2: 
  ```javascript
  $('#cy-div').cytoscape(...)
  ```

  v3:
  ```javascript
  cytoscape({ container: $('#cy-div'), ... })
  ```

- `cy.load( ... )` was deprecated in v2 and has been removed in v3 [#1534](https://github.com/cytoscape/cytoscape.js/issues/1534)

  ```javascript
  // OLD
  cy.load( ... );

  // v3
  cy.elements().remove();
  cy.add( ... );
  cy.layout( opts ).run(); // .run() is also new to v3
  ```

- `layout()` and `scratch()` mapper support was deprecated in v2 and has been removed in v3 [#1536](https://github.com/cytoscape/cytoscape.js/issues/1536)
  - Old: `'scratch(foo)'`
  - v3: `function(ele) { return ele.scratch('foo') }`

- `initRender()` has been removed after deprecation in v2 [#1538](https://github.com/cytoscape/cytoscape.js/issues/1538)
  - Instead, use a combination of `cy.one()` and the `render` event
  - For example, `cy.one('render', () => console.log('initial render'))`

- The `inhibitor` arrow shape has been removed [#1655](https://github.com/cytoscape/cytoscape.js/issues/1655)
  - The shape was never publically documented (and had an incorrect name)

- `cose` layout has been moved to an external repo [#1687](https://github.com/cytoscape/cytoscape.js/issues/1687)
  - The `cose` layout is the only layout with an external dependency (`weaver`); it's removal shrinks the base lib size
  - In the browser, `cose` will automatically register itself when included via a `<script>` tag.
  - For Node.js environments:

  ```javascript
  var cytoscape = require('cytoscape');
  var cose = require('cose');
  cose( cytoscape ); // register extension
  ```

  - **TODO: update as changes to [#1687](https://github.com/cytoscape/cytoscape.js/issues/1687) and [#1686](https://github.com/cytoscape/cytoscape.js/issues/1686) happen**

  # Example migration from v2 to v3
